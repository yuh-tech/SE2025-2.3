# üîê OAuth 2.0 & OpenID Connect Authorization Server

Authorization Server ho√†n ch·ªânh tu√¢n th·ªß chu·∫©n **OAuth 2.0** v√† **OpenID Connect**, x√¢y d·ª±ng b·∫±ng **Node.js** v√† th∆∞ vi·ªán **oidc-provider**.

## üìã M·ª•c l·ª•c

- [T√≠nh nƒÉng](#-t√≠nh-nƒÉng)
- [Ki·∫øn tr√∫c](#-ki·∫øn-tr√∫c)
- [Y√™u c·∫ßu h·ªá th·ªëng](#-y√™u-c·∫ßu-h·ªá-th·ªëng)
- [C√†i ƒë·∫∑t](#-c√†i-ƒë·∫∑t)
- [C·∫•u h√¨nh](#-c·∫•u-h√¨nh)
- [Ch·∫°y ·ª©ng d·ª•ng](#-ch·∫°y-·ª©ng-d·ª•ng)
- [Ki·ªÉm th·ª≠](#-ki·ªÉm-th·ª≠)
- [Flow Authorization Code](#-flow-authorization-code)
- [API Endpoints](#-api-endpoints)
- [C·∫•u tr√∫c d·ª± √°n](#-c·∫•u-tr√∫c-d·ª±-√°n)
- [T√†i li·ªáu tham kh·∫£o](#-t√†i-li·ªáu-tham-kh·∫£o)

## ‚ú® T√≠nh nƒÉng

### OAuth 2.0 Flows
- ‚úÖ **Authorization Code Flow** - Flow chu·∫©n cho web applications
- ‚úÖ **Authorization Code + PKCE** - B·∫£o m·∫≠t cho SPA v√† Mobile apps
- ‚úÖ **Client Credentials Flow** - Cho server-to-server authentication
- ‚úÖ **Refresh Token Flow** - Gia h·∫°n access token

### OpenID Connect
- ‚úÖ **ID Token** (JWT) - Ch·ª©a th√¥ng tin x√°c th·ª±c ng∆∞·ªùi d√πng
- ‚úÖ **UserInfo Endpoint** - L·∫•y th√¥ng tin chi ti·∫øt ng∆∞·ªùi d√πng
- ‚úÖ **Discovery Document** - T·ª± ƒë·ªông kh√°m ph√° c·∫•u h√¨nh
- ‚úÖ **JWKS Endpoint** - Public keys ƒë·ªÉ verify JWT

### Token Types
- üîë **Access Token** - JWT signed b·∫±ng RS256
- üÜî **ID Token** - JWT ch·ª©a claims ng∆∞·ªùi d√πng
- üîÑ **Refresh Token** - Long-lived token ƒë·ªÉ gia h·∫°n
- üìù **Authorization Code** - Short-lived code ƒë·ªïi l·∫•y tokens

### Security Features
- üîí **PKCE** (Proof Key for Code Exchange) - B·∫Øt bu·ªôc cho public clients
- üîê **JWT Signing** - RSA key pair (RS256)
- üç™ **Secure Cookies** - HttpOnly, SameSite
- üîÑ **Token Rotation** - Refresh token rotation
- ‚è∞ **Token Expiration** - Configurable TTL

### User Interface
- üé® **Modern UI** - Responsive design v·ªõi gradient backgrounds
- üì± **Mobile Friendly** - T·ªëi ∆∞u cho m·ªçi k√≠ch th∆∞·ªõc m√†n h√¨nh
- üåê **ƒêa ng√¥n ng·ªØ** - H·ªó tr·ª£ ti·∫øng Vi·ªát
- ‚úÖ **Login Form** - Giao di·ªán ƒëƒÉng nh·∫≠p ƒë·∫πp m·∫Øt
- üîê **Consent Screen** - X√°c nh·∫≠n quy·ªÅn truy c·∫≠p r√µ r√†ng

## üèóÔ∏è Ki·∫øn tr√∫c

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             ‚îÇ          ‚îÇ                  ‚îÇ          ‚îÇ             ‚îÇ
‚îÇ   Client    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Authorization   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Resource  ‚îÇ
‚îÇ Application ‚îÇ          ‚îÇ     Server       ‚îÇ          ‚îÇ    Owner    ‚îÇ
‚îÇ             ‚îÇ          ‚îÇ   (This Server)  ‚îÇ          ‚îÇ    (User)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                                  ‚îÇ
                                  ‚ñº
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ                 ‚îÇ
                         ‚îÇ  Token Storage  ‚îÇ
                         ‚îÇ  (In-Memory /   ‚îÇ
                         ‚îÇ     Redis)      ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Lu·ªìng ho·∫°t ƒë·ªông Authorization Code Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ      ‚îÇ‚îÄ‚îÄ(1) Authorization Request‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ          ‚îÇ
‚îÇ      ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ      ‚îÇ‚óÑ‚îÄ(2) Login & Consent Form‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  Auth    ‚îÇ
‚îÇ      ‚îÇ                                           ‚îÇ  Server  ‚îÇ
‚îÇ User ‚îÇ‚îÄ‚îÄ(3) Submit Credentials & Approval‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ          ‚îÇ
‚îÇAgent ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ      ‚îÇ‚óÑ‚îÄ(4) Authorization Code‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§          ‚îÇ
‚îÇ      ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ      ‚îÇ‚îÄ‚îÄ(5) Token Request (code + client_id)‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ          ‚îÇ
‚îÇ      ‚îÇ                                           ‚îÇ          ‚îÇ
‚îÇ      ‚îÇ‚óÑ‚îÄ(6) Access Token + ID Token + Refresh‚îÄ‚îÄ‚î§          ‚îÇ
‚îÇ      ‚îÇ                                           ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üíª Y√™u c·∫ßu h·ªá th·ªëng

- **Node.js** >= 18.0.0
- **npm** >= 8.0.0
- **Redis** (t√πy ch·ªçn, cho production)

## üì¶ C√†i ƒë·∫∑t

### 1. Clone repository v√† c√†i ƒë·∫∑t dependencies

```bash
# Di chuy·ªÉn v√†o th∆∞ m·ª•c d·ª± √°n
cd Final_Project

# C√†i ƒë·∫∑t dependencies
npm install
```

### 2. T·∫°o file .env

```bash
# Copy file .env.example
cp .env.example .env
```

### 3. Ch·ªânh s·ª≠a file .env (t√πy ch·ªçn)

```env
PORT=3000
ISSUER=http://localhost:3000
COOKIE_KEYS=your-secret-key-1,your-secret-key-2
SESSION_SECRET=your-session-secret

# Redis (optional)
# USE_REDIS=true
# REDIS_URL=redis://localhost:6379
```

## ‚öôÔ∏è C·∫•u h√¨nh

### Clients Configuration

Ch·ªânh s·ª≠a file `src/config/clients.js` ƒë·ªÉ th√™m/s·ª≠a clients:

```javascript
{
  client_id: 'your-client-id',
  client_secret: 'your-client-secret',
  redirect_uris: ['http://localhost:3000/callback'],
  grant_types: ['authorization_code', 'refresh_token'],
  scope: 'openid profile email'
}
```

### Scopes Configuration

Ch·ªânh s·ª≠a file `src/config/scopes.js` ƒë·ªÉ ƒë·ªãnh nghƒ©a scopes:

```javascript
'custom:scope': {
  description: 'Your custom scope description',
  claims: ['custom_claim']
}
```

### Users Database

Ch·ªânh s·ª≠a file `src/services/userService.js` ƒë·ªÉ th√™m users demo ho·∫∑c k·∫øt n·ªëi database th·ª±c:

```javascript
const USERS_DB = [
  {
    id: '1',
    username: 'admin',
    password: 'admin123', // Hash trong production!
    email: 'admin@example.com',
    name: 'Administrator'
  }
];
```

## üöÄ Ch·∫°y ·ª©ng d·ª•ng

### Development Mode

```bash
npm start
```

ho·∫∑c v·ªõi nodemon (auto-reload):

```bash
npm run dev
```

Server s·∫Ω ch·∫°y t·∫°i: **http://localhost:3000**

### Production Mode

```bash
NODE_ENV=production npm start
```

**L∆∞u √Ω:** Trong production n√™n:
- S·ª≠ d·ª•ng Redis cho session storage
- S·ª≠ d·ª•ng HTTPS (secure cookies)
- Hash passwords (bcrypt)
- L∆∞u clients v√† users trong database
- Set COOKIE_KEYS v√† SESSION_SECRET m·∫°nh

## üß™ Ki·ªÉm th·ª≠

### 1. Ki·ªÉm tra Discovery Document

```bash
curl http://localhost:3000/.well-known/openid-configuration
```

### 2. Ki·ªÉm tra JWKS

```bash
curl http://localhost:3000/jwks.json
```

### 3. Test Authorization Code Flow v·ªõi curl

#### B∆∞·ªõc 1: L·∫•y Authorization Code

M·ªü tr√¨nh duy·ªát v√† truy c·∫≠p:

```
http://localhost:3000/authorize?client_id=demo-client&redirect_uri=http://localhost:3000/callback&response_type=code&scope=openid%20profile%20email&state=abc123
```

ƒêƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n demo:
- Username: `admin`
- Password: `admin123`

Sau khi consent, b·∫°n s·∫Ω ƒë∆∞·ª£c redirect ƒë·∫øn:
```
http://localhost:3000/callback?code=AUTHORIZATION_CODE&state=abc123
```

Copy `AUTHORIZATION_CODE` t·ª´ URL.

#### B∆∞·ªõc 2: ƒê·ªïi Code l·∫•y Tokens

```bash
curl -X POST http://localhost:3000/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -u "demo-client:demo-client-secret" \
  -d "grant_type=authorization_code" \
  -d "code=AUTHORIZATION_CODE" \
  -d "redirect_uri=http://localhost:3000/callback"
```

Response:
```json
{
  "access_token": "eyJhbGci...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "id_token": "eyJhbGci...",
  "refresh_token": "...",
  "scope": "openid profile email"
}
```

#### B∆∞·ªõc 3: L·∫•y UserInfo

```bash
curl http://localhost:3000/userinfo \
  -H "Authorization: Bearer ACCESS_TOKEN"
```

Response:
```json
{
  "sub": "1",
  "name": "Administrator",
  "email": "admin@example.com",
  "email_verified": true,
  "given_name": "Admin",
  "family_name": "User"
}
```

#### B∆∞·ªõc 4: Refresh Token

```bash
curl -X POST http://localhost:3000/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -u "demo-client:demo-client-secret" \
  -d "grant_type=refresh_token" \
  -d "refresh_token=REFRESH_TOKEN"
```

### 4. Test Client Credentials Flow

```bash
curl -X POST http://localhost:3000/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -u "service-client:service-client-secret" \
  -d "grant_type=client_credentials" \
  -d "scope=api:read api:write"
```

### 5. Test v·ªõi Postman

Import collection n√†y v√†o Postman:

#### Authorization Code Flow - Step 1: Authorization URL

- Method: GET
- URL: `http://localhost:3000/authorize`
- Params:
  - client_id: `demo-client`
  - redirect_uri: `http://localhost:3000/callback`
  - response_type: `code`
  - scope: `openid profile email`
  - state: `random-state-string`

#### Authorization Code Flow - Step 2: Token Request

- Method: POST
- URL: `http://localhost:3000/token`
- Auth: Basic Auth
  - Username: `demo-client`
  - Password: `demo-client-secret`
- Body (x-www-form-urlencoded):
  - grant_type: `authorization_code`
  - code: `[CODE_FROM_STEP_1]`
  - redirect_uri: `http://localhost:3000/callback`

#### UserInfo Request

- Method: GET
- URL: `http://localhost:3000/userinfo`
- Headers:
  - Authorization: `Bearer [ACCESS_TOKEN]`

## üìñ Flow Authorization Code (Chi ti·∫øt)

### 1. Authorization Request

Client g·ª≠i request ƒë·∫øn authorization endpoint:

```
GET /authorize?
  response_type=code&
  client_id=demo-client&
  redirect_uri=http://localhost:3000/callback&
  scope=openid profile email&
  state=abc123
```

### 2. User Authentication

Server ki·ªÉm tra session, n·∫øu ch∆∞a login th√¨ redirect ƒë·∫øn `/login`.

User nh·∫≠p username/password v√† submit form.

### 3. Consent

Sau khi login th√†nh c√¥ng, server hi·ªÉn th·ªã consent screen y√™u c·∫ßu user x√°c nh·∫≠n c·∫•p quy·ªÅn cho client.

### 4. Authorization Code

Khi user ƒë·ªìng √Ω, server t·∫°o authorization code v√† redirect v·ªÅ client:

```
HTTP/1.1 302 Found
Location: http://localhost:3000/callback?code=xxx&state=abc123
```

### 5. Token Request

Client g·ª≠i code ƒë·∫øn token endpoint ƒë·ªÉ ƒë·ªïi l·∫•y tokens:

```
POST /token HTTP/1.1
Host: localhost:3000
Authorization: Basic base64(client_id:client_secret)
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&
code=xxx&
redirect_uri=http://localhost:3000/callback
```

### 6. Token Response

Server tr·∫£ v·ªÅ tokens:

```json
{
  "access_token": "eyJhbGci...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "id_token": "eyJhbGci...",
  "refresh_token": "...",
  "scope": "openid profile email"
}
```

### 7. Access Protected Resource

Client s·ª≠ d·ª•ng access token ƒë·ªÉ g·ªçi UserInfo endpoint:

```
GET /userinfo HTTP/1.1
Host: localhost:3000
Authorization: Bearer eyJhbGci...
```

## üîå API Endpoints

### Discovery & Metadata

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/.well-known/openid-configuration` | GET | OpenID Connect Discovery Document |
| `/jwks.json` | GET | JSON Web Key Set (public keys) |

### OAuth/OIDC Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/authorize` | GET | Authorization endpoint (OAuth 2.0) |
| `/token` | POST | Token endpoint |
| `/userinfo` | GET | UserInfo endpoint (OIDC) |
| `/revoke` | POST | Token revocation endpoint |
| `/introspect` | POST | Token introspection endpoint |
| `/logout` | GET/POST | End session endpoint |

### Custom Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/` | GET | Home page |
| `/login` | GET/POST | Login page |
| `/interaction/:uid` | GET/POST | Interaction handling |
| `/session/logout` | GET/POST | User logout |
| `/health` | GET | Health check |

## üìÅ C·∫•u tr√∫c d·ª± √°n

```
Final_Project/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js              # Entry point, kh·ªüi t·∫°o Express server
‚îÇ   ‚îú‚îÄ‚îÄ provider.js           # C·∫•u h√¨nh v√† kh·ªüi t·∫°o oidc-provider
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ config/               # Configuration files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients.js        # Danh s√°ch OAuth clients
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scopes.js         # ƒê·ªãnh nghƒ©a scopes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ claims.js         # ƒê·ªãnh nghƒ©a claims
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.js       # Provider settings
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/               # Express routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.js          # Login form v√† x√°c th·ª±c
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interaction.js    # OIDC interactions (consent, etc.)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout.js         # Logout handling
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/             # Business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userService.js    # User authentication & management
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                # Utilities
‚îÇ       ‚îî‚îÄ‚îÄ db.js             # Database adapter (in-memory/Redis)
‚îÇ
‚îú‚îÄ‚îÄ node-oidc-provider/       # oidc-provider library (local)
‚îÇ
‚îú‚îÄ‚îÄ package.json              # Dependencies
‚îú‚îÄ‚îÄ .env                      # Environment variables (create from .env.example)
‚îú‚îÄ‚îÄ .env.example              # Environment variables template
‚îî‚îÄ‚îÄ README.md                 # This file
```

### Gi·∫£i th√≠ch c√°c file ch√≠nh

#### `src/index.js`
Entry point c·ªßa ·ª©ng d·ª•ng. Kh·ªüi t·∫°o Express server, session middleware, mount OIDC provider v√† custom routes.

#### `src/provider.js`
Kh·ªüi t·∫°o v√† c·∫•u h√¨nh `oidc-provider`. Sinh RSA key pair cho JWT signing, c·∫•u h√¨nh JWKS, claims, scopes, TTL, v√† c√°c event listeners.

#### `src/config/clients.js`
Danh s√°ch c√°c OAuth clients ƒë∆∞·ª£c ph√©p k·∫øt n·ªëi. M·ªói client c√≥:
- `client_id`: ID duy nh·∫•t
- `client_secret`: Secret (cho confidential clients)
- `redirect_uris`: Danh s√°ch redirect URIs h·ª£p l·ªá
- `grant_types`: C√°c grant types ƒë∆∞·ª£c ph√©p
- `scope`: Scopes m·∫∑c ƒë·ªãnh

#### `src/config/scopes.js`
ƒê·ªãnh nghƒ©a c√°c OAuth scopes v√† claims t∆∞∆°ng ·ª©ng. V√≠ d·ª•: scope `profile` bao g·ªìm claims `name`, `given_name`, `family_name`, etc.

#### `src/config/claims.js`
ƒê·ªãnh nghƒ©a c√°c OIDC claims (user attributes) v·ªõi type v√† description.

#### `src/config/settings.js`
C·∫•u h√¨nh t·ªïng th·ªÉ cho oidc-provider:
- Features (PKCE, revocation, introspection, etc.)
- TTL cho c√°c lo·∫°i tokens
- Response types & grant types
- Cookie configuration
- Interactions configuration

#### `src/services/userService.js`
X·ª≠ l√Ω x√°c th·ª±c user v√† qu·∫£n l√Ω user data. Trong demo s·ª≠ d·ª•ng in-memory database, production n√™n k·∫øt n·ªëi database th·ª±c v√† hash passwords.

#### `src/routes/login.js`
X·ª≠ l√Ω login form. Hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p, x√°c th·ª±c credentials, l∆∞u user v√†o session.

#### `src/routes/interaction.js`
X·ª≠ l√Ω OIDC interactions nh∆∞ login prompt v√† consent. Hi·ªÉn th·ªã consent screen v·ªõi danh s√°ch scopes/permissions, x·ª≠ l√Ω user approval/denial.

#### `src/routes/logout.js`
X·ª≠ l√Ω logout. X√≥a session v√† hi·ªÉn th·ªã trang logout th√†nh c√¥ng.

#### `src/utils/db.js`
Cung c·∫•p adapter cho OIDC provider storage. M·∫∑c ƒë·ªãnh s·ª≠ d·ª•ng in-memory, c√≥ th·ªÉ m·ªü r·ªông cho Redis ho·∫∑c database.

## üîê Security Best Practices

### Development
- ‚úÖ In-memory session storage
- ‚úÖ Self-signed certificates OK
- ‚úÖ Plain text secrets trong .env
- ‚úÖ Detailed error messages

### Production
- ‚ö†Ô∏è **PH·∫¢I** s·ª≠ d·ª•ng HTTPS
- ‚ö†Ô∏è **PH·∫¢I** s·ª≠ d·ª•ng Redis cho session storage
- ‚ö†Ô∏è **PH·∫¢I** hash passwords (bcrypt, argon2)
- ‚ö†Ô∏è **PH·∫¢I** s·ª≠ d·ª•ng strong secrets (crypto.randomBytes)
- ‚ö†Ô∏è **PH·∫¢I** l∆∞u clients trong database
- ‚ö†Ô∏è **PH·∫¢I** implement rate limiting
- ‚ö†Ô∏è **PH·∫¢I** enable CORS restrictions
- ‚ö†Ô∏è **PH·∫¢I** validate redirect_uris strictly
- ‚ö†Ô∏è **N√äN** implement audit logging
- ‚ö†Ô∏è **N√äN** monitor suspicious activities

## üéì Demo Credentials

### Demo Users

| Username | Password | Role | Email |
|----------|----------|------|-------|
| admin | admin123 | admin | admin@example.com |
| user | user123 | user | user@example.com |
| demo | demo123 | user | demo@example.com |

### Demo Clients

| Client ID | Client Secret | Flow | Redirect URI |
|-----------|---------------|------|--------------|
| demo-client | demo-client-secret | Authorization Code | http://localhost:3000/callback |
| spa-client | (none - public) | Authorization Code + PKCE | http://localhost:4200/callback |
| service-client | service-client-secret | Client Credentials | N/A |
| mobile-app | (none - public) | Authorization Code + PKCE | myapp://callback |

## üìö T√†i li·ªáu tham kh·∫£o

### Specifications
- [OAuth 2.0 RFC 6749](https://datatracker.ietf.org/doc/html/rfc6749)
- [OpenID Connect Core](https://openid.net/specs/openid-connect-core-1_0.html)
- [PKCE RFC 7636](https://datatracker.ietf.org/doc/html/rfc7636)
- [JWT RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519)

### Libraries
- [oidc-provider](https://github.com/panva/node-oidc-provider)
- [jose](https://github.com/panva/jose)
- [Express](https://expressjs.com/)
- [express-session](https://github.com/expressjs/session)

### Tools
- [jwt.io](https://jwt.io/) - JWT Debugger
- [oauth.tools](https://oauth.tools/) - OAuth Testing
- [Postman](https://www.postman.com/) - API Testing

## ‚ùì Troubleshooting

### Server kh√¥ng kh·ªüi ƒë·ªông

```bash
# Ki·ªÉm tra port ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng ch∆∞a
lsof -i :3000

# Ho·∫∑c thay ƒë·ªïi port trong .env
PORT=3001
```

### L·ªói "Cannot find module"

```bash
# Reinstall dependencies
rm -rf node_modules package-lock.json
npm install
```

### Session kh√¥ng persist

Ki·ªÉm tra session configuration trong `src/index.js`. N·∫øu d√πng Redis, ƒë·∫£m b·∫£o Redis ƒëang ch·∫°y:

```bash
redis-cli ping
# Response: PONG
```

### CORS errors

Trong production, c·∫•u h√¨nh CORS trong `src/config/settings.js`:

```javascript
clientBasedCORS: (ctx, origin, client) => {
  // Ch·ªâ allow specific origins
  return ['https://myapp.com'].includes(origin);
}
```

## üìÑ License

MIT License - T·ª± do s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† th∆∞∆°ng m·∫°i.

## üë®‚Äçüíª Author

D·ª± √°n demo OAuth 2.0 & OpenID Connect Authorization Server

---

**‚ö†Ô∏è L∆∞u √Ω:** ƒê√¢y l√† server demo cho m·ª•c ƒë√≠ch h·ªçc t·∫≠p. Trong production, c·∫ßn implement th√™m nhi·ªÅu security measures v√† s·ª≠ d·ª•ng database th·ª±c.

**Happy Coding! üöÄ**

